{% load static %}
{% load mathfilters %}
<!DOCTYPE html>
<html lang="es-mx">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ saludo }}</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/estilos.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'css/tables.css' %}" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <ul class="navbar-nav me-auto">
            <li class="nav-item">
                <a href="{% url 'inicio' %}" class="nav-link">Inicio</a>
            </li>
        </ul>
        {% if privilegio == 'ADM-IN1' %}
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Inventario
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'Inventario_general' %}">Inventario general</a>
                    <a class="dropdown-item text-white" href="{% url 'compras' %}">Entradas</a>
                    <a class="dropdown-item text-white" href="{% url 'ventas' %}">Ventas</a>
                    <a class="dropdown-item text-white" href="{% url 'otras_e_s' %}">Otras E/S</a>
                    <a class="dropdown-item text-white" href="{% url 'crear_sistema' %}">Generar sistemas</a>
                    <a class="dropdown-item text-white" href="{% url 'movimientos' %}">Movimientos de inventario</a>
                    <a class="dropdown-item text-white" href="{% url 'Auditoria' %}">Auditoria</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Recursos humanos
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'perfil_y_directorio' %}">Perfil de puesto - Directorio</a>
                    <a class="dropdown-item text-white" href="{% url 'eventos_tareas' %}">Eventos y tareas asignados</a>
                    <a class="dropdown-item text-white" href="{% url 'acci_vista' %}">Accidentabilidad</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Mantenimiento
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'mantenimiento' %}">Mantenimiento</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    SIGSSMAC
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'sigssmac_vista' %}">Registro de hallazgos</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Indicadores
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'indicadores' %}">Registro de movimientos</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Usuarios
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'registro' %}">Registrar usuario</a>
                    <a class="dropdown-item text-white" href="{% url 'usuarios' %}">Usuarios</a>
                </div>
            </div>
        </ul>
        {% elif privilegio == 'JEFE' %}
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Inventario
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'Inventario_general' %}">Inventario general</a>
                    <a class="dropdown-item text-white" href="{% url 'compras' %}">Entradas</a>
                    <a class="dropdown-item text-white" href="{% url 'ventas' %}">Ventas</a>
                    <a class="dropdown-item text-white" href="{% url 'otras_e_s' %}">Otras E/S</a>
                    <a class="dropdown-item text-white" href="{% url 'crear_sistema' %}">Generar sistemas</a>
                    <a class="dropdown-item text-white" href="{% url 'movimientos' %}">Movimientos de inventario</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Recursos humanos
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'perfil_y_directorio' %}">Perfil de puesto - Directorio</a>
                    <a class="dropdown-item text-white" href="{% url 'eventos_tareas' %}">Eventos y tareas asignados</a>
                    <a class="dropdown-item text-white" href="{% url 'acci_vista' %}">Accidentabilidad</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Mantenimiento
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'mantenimiento' %}">Mantenimiento</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    SIGSSMAC
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'sigssmac_vista' %}">Registro de hallazgos</a>
                </div>
            </div>
        </ul>
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Indicadores
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'indicadores' %}">Registro de movimientos</a>
                </div>
            </div>
        </ul>
        {% else %}
        <ul class="navbar-nav me-auto">
            <div class="dropdown">
                <button class="nav-link dropdown-toggle btn" type="button" id="navbarDropdown" aria-haspopup="true" data-toggle="dropdown" aria-expanded="false">
                    Inventario
                </button>
                <div class="dropdown-menu bg-dark" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item text-white" href="{% url 'Inventario_general' %}">Inventario general</a>
                    <a class="dropdown-item text-white" href="{% url 'movimientos' %}">Movimientos de inventario</a>
                </div>
            </div>
        </ul>
        {% endif %}
        <ul class="navbar-nav">
            <li class="nav-item"><a class="nav-link" href="{% url 'cerrar_sesion' %}">Cerrar sesión</a></li>
        </ul>
    </nav>
    <div class="mt-3 container d-flex justify-content-between align-items-center col-lg-12">
        <div class="col-lg-6">
            <div>
                <canvas width="800" height="250" id="otra_cosa"></canvas>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-starts">
            <div>
                <canvas width="300" height="200" id="datos_accidentabilidad"></canvas>
            </div>
            <div class="custom-scrollbar-total">
                <table class="table_res_final table-hover">
                    <thead>
                        <tr>
                            <th>Mes</th>
                            <th>Total de empleados</th>
                            <th>Cálculo total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for det in detalles_acci %}
                            <tr>
                                <td>{{ det.0 }}</td>
                                <td>{{ det.1 }}</td>
                                <td>{{ det.4 }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <td>TOTAL</td>
                            <td>{{ total_emp }}</td>
                            <td>{{ total_est }}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
    <div class="mt-5 container">
        <div class="custom-scrollbar d-flex justify-content-between align-items-start col-lg-12">
            <div class="col-lg-6">
                <h4 class="text-center">Personal propio</h4>
                <table class="table_res table table-hover">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cantidad de empleados</th>
                            <th>Horas de trabajo</th>
                            <th>Jornada laboral</th>
                            <th>Cálculo total</th>
                            <th>Índice de frecuencia</th>
                            <th>Índice de gravedad</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for con in personal_contratado %}
                            <tr>
                                <td>{{ con.5 }} {{ con.6 }}</td>
                                <td>{{ con.1 }}</td>
                                <td>{{ con.2 }}</td>
                                <td>{{ con.3 }}</td>
                                <td>{{ con.4 }}</td>
                                <td>{{ con.8|div:con.2 }}</td>
                                <td>{{ con.7|div:(con.2|mul:1000000) }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="col-lg-6">
                <h4 class="text-center">Personal subcontratado</h4>
                <table class="table_res table table-hover">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Cantidad de empleados</th>
                            <th>Horas de trabajo</th>
                            <th>Jornada laboral</th>
                            <th>Cálculo total</th>
                            <th>Índice de frecuencia</th>
                            <th>Índice de gravedad</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for propio in personal_propio %}
                        <tr>
                            <td>{{ propio.5 }} {{ propio.6 }}</td>
                            <td>{{ propio.1 }}</td>
                            <td>{{ propio.2 }}</td>
                            <td>{{ propio.3 }}</td>
                            <td>{{ propio.4 }}</td>
                            <td>{{ con.8 / con.2 }}</td>
                            <td>{{ con.7 / (con.2 * 1000000) }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        <div class="custom-scrollbar mt-3">
            <table class="table_res table table-hover">
                <thead>
                    <tr>
                        <th>Mes</th>
                        <th>Cantidad de empleados</th>
                        <th>Accidentes con baja</th>
                        <th>Días incapacitantes</th>
                        <th>Cálculo total</th>
                    </tr>
                </thead>
                <tbody>
                    {% for det in detalles_acci %}
                        <tr>
                            <td>{{ det.0 }}</td>
                            <td>{{ det.1 }}</td>
                            <td>{{ det.2 }}</td>
                            <td>{{ det.3 }}</td>
                            <td>{{ det.4 }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="container">
        <form class="card card-body form-registro">
            <h1 class="text-center">Accidentabilidad</h1>
            {% csrf_token %}
            <div class="d-flex align-items-center col-lg-12 mt-1 mb-1">
                <div class="d-flex justify-content-center align-items-center">
                    <label class="col-lg-5">Seleccionar mes</label>
                    <div class="col-lg-7">
                        <select name="sl_mes" class="form-select">
                            <option selected disabled>--Seleccionar--</option>
                            <option value="ENERO">ENERO</option>
                            <option value="FEBRERO">FEBRERO</option>
                            <option value="MARZO">MARZO</option>
                            <option value="ABRIL">ABRIL</option>
                            <option value="MAYO">MAYO</option>
                            <option value="JUNIO">JUNIOo</option>
                            <option value="JULIO">JULIO</option>
                            <option value="AGOSTO">AGOSTO</option>
                            <option value="SEPTIEMBRE">SEPTIEMBRE</option>
                            <option value="OCTUBRE">OCTUBRE</option>
                            <option value="NOVIEMBRE">NOVIEMBRE</option>
                            <option value="DICIEMBRE">DICIEMBRE</option>
                        </select>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center">
                    <label class="col-lg-2">Año</label>
                    <div class="col-lg-4">
                        <input type="text" name="anio" class="form-control">
                    </div>
                </div>
            </div>
            <h5>Personal propio</h5>
            <div class="d-flex justify-content-around align-items-center col-lg-12">
                <div class="col-lg-3">
                    <label class="d-block">Cantidad de empleados</label>
                    <input type="number" class="form-control" step="any" name="c_personal">
                </div>
                <div class="col-lg-3">
                    <label class="d-block">Horas de trabajo</label>
                    <input type="number" class="form-control" step="any" name="h_trabajo">
                </div>
                <div class="col-lg-3">
                    <label class="d-block">Dias laborados</label>
                    <input type="number" class="form-control" step="any" name="jornada">
                </div>
            </div>
            <div class="d-flex justify-content-around col-lg-12">
                <div class="col-lg-5">
                    <label class="d-block">Accidentes con baja</label>
                    <input type="number" class="form-control" step="any" name="acci_c_baja">
                </div>
                <div class="col-lg-5">
                    <label class="d-block">Dias incapacitantes</label>
                    <input type="number" class="form-control" step="any" name="dias_inc">
                </div>
            </div>
            <h5>Personal subcontratado</h5>
            <div class="d-flex justify-content-around align-items-center col-lg-12">
                <div class="col-lg-3">
                    <label class="d-block">Cantidad de empleados</label>
                    <input type="number" class="form-control" step="any" name="c_personal">
                </div>
                <div class="col-lg-3">
                    <label class="d-block">Horas de trabajo</label>
                    <input type="number" class="form-control" step="any" name="h_trabajo">
                </div>
                <div class="col-lg-3">
                    <label class="d-block">Dias laborados</label>
                    <input type="number" class="form-control" step="any" name="jornada">
                </div>
            </div>
            <div class="d-flex justify-content-around col-lg-12">
                <div class="col-lg-5">
                    <label class="d-block">Accidentes con baja</label>
                    <input type="number" class="form-control" step="any" name="acci_c_baja">
                </div>
                <div class="col-lg-5">
                    <label class="d-block">Dias incapacitantes</label>
                    <input type="number" class="form-control" step="any" name="dias_inc">
                </div>
            </div>
            <input type="submit" id="btnEnviar" class="btn btn-success form-control mt-3" value="Registrar">
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <script src="{% static 'js/accidentabilidad.js' %}"></script>
    
</body>
</html>